<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê¹€íš¨ì • íšŒê³„ì‚¬ë‹˜ì„ ê¸°ì–µí•˜ë©°</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #ffffff;
      color: #1f2937;
      padding: 40px;
    }
    .container {
      max-width: 720px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 32px;
    }
    .card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }
    textarea {
      width: 100%;
      height: 120px;
      margin-top: 8px;
      padding: 10px;
      box-sizing: border-box;
    }
    button {
      margin-top: 12px;
      padding: 8px 16px;
      border: none;
      background: #111827;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #374151;
    }
    img {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 6px;
    }
    .hidden {
      display: none;
    }
    /* ì¸ìŠ¤íƒ€ ê°ì„± ë©”ëª¨ë¦¬ ì¹´ë“œ */
    .memory-card {
      background: #ffffff;
      border-radius: 18px;
      padding: 14px;
      margin-bottom: 26px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .memory-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 36px rgba(0, 0, 0, 0.08);
    }

    .memory-card img {
      width: 100%;
      border-radius: 14px;
      margin-bottom: 12px;
      object-fit: cover;
    }

    .memory-text {
      font-size: 15px;
      line-height: 1.7;
      color: #111827;
      margin-bottom: 10px;
      white-space: pre-line;
    }

    .memory-date {
      font-size: 12px;
      color: #9ca3af;
    }



  </style>
</head>
<body>

<div class="container">

  <h1>ê¹€íš¨ì • íšŒê³„ì‚¬ë‹˜ì„ ê¸°ì–µí•˜ë©°</h1>

  <!-- ë¡œê·¸ì¸ ì¹´ë“œ -->
  <div id="loginCard" class="card">
    <button onclick="loginWithGoogle()">ğŸ” êµ¬ê¸€ë¡œ ë¡œê·¸ì¸</button>
  </div>

  <!-- ê¸€ ì‘ì„± -->
  <div id="writeCard" class="card hidden">
    <h2>ê¸°ì–µ ë‚¨ê¸°ê¸°</h2>
    <textarea id="message" placeholder="ë‹¹ì‹ ì˜ ê¸°ì–µì„ ë‚¨ê²¨ì£¼ì„¸ìš”"></textarea>
    <input type="file" id="image" accept="image/*" />
    <button id="submitBtn">ê¸°ì–µ ë‚¨ê¸°ê¸°</button>
  </div>

  <!-- ëª©ë¡ -->
  <div id="listCard" class="card hidden">
    <h2>ë‚¨ê²¨ì§„ ê¸°ì–µë“¤</h2>
    <div id="list"></div>
  </div>

</div>

<script>
  /* âœ… Supabase í´ë¼ì´ì–¸íŠ¸ (í•˜ë‚˜ë§Œ!) */
  const supabaseClient = window.supabase.createClient(
  "https://upxuhfajteosglolyctq.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVweHVoZmFqdGVvc2dsb2x5Y3RxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MjY5MzAsImV4cCI6MjA4MjUwMjkzMH0.ZlN9--ksRnn92I0vRqEB2Ph88vixMHo5uKyBG1qDbGM",
    {
    auth: {
      persistSession: true,
      autoRefreshToken: true,
      detectSessionInUrl: true,
      flowType: "pkce"
    }
    }
  );

  /* âœ… êµ¬ê¸€ ë¡œê·¸ì¸ */
  async function loginWithGoogle() {
  await supabaseClient.auth.signInWithOAuth({
    provider: "google",
    options: {
      redirectTo: window.location.origin
      }
    });
  }

  /* âœ… ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬ */
  supabaseClient.auth.onAuthStateChange((_event, session) => {
    if (session) {
      document.getElementById("loginCard").classList.add("hidden");
      document.getElementById("writeCard").classList.remove("hidden");
      document.getElementById("listCard").classList.remove("hidden");
      loadMemories();
    }
  });

  /* âœ… ê¸€ ì €ì¥ */
  async function submitMemory() {
    const message = document.getElementById("message").value;
    const fileInput = document.getElementById("image");
    let imageUrl = null;

    if (!message.trim()) return;

    if (fileInput.files.length > 0) {
      const file = fileInput.files[0];
      const fileName = `${Date.now()}_${file.name}`;

      const { error } = await supabaseClient
        .storage
        .from("uploads")
        .upload(fileName, file);

      if (!error) {
        imageUrl = supabaseClient
          .storage
          .from("uploads")
          .getPublicUrl(fileName).data.publicUrl;
      }
    }

    await supabaseClient.from("memories").insert([
      { message, image_url: imageUrl }
    ]);

    document.getElementById("message").value = "";
    fileInput.value = "";
    loadMemories();
  }

  document
    .getElementById("submitBtn")
    .addEventListener("click", submitMemory);

  /* âœ… ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° */
  async function loadMemories() {
    const { data } = await supabaseClient
      .from("memories")
      .select("*")
      .order("created_at", { ascending: false });

    const list = document.getElementById("list");
    list.innerHTML = "";

    data.forEach(item => {
  const div = document.createElement("div");
  div.className = "memory-card";

  const date = new Date(item.created_at).toLocaleDateString("ko-KR");

  div.innerHTML = `
    ${item.image_url ? `<img src="${item.image_url}" />` : ""}
    <p class="memory-text">${item.message}</p>
    <div class="memory-date">${date}</div>
  `;

  list.appendChild(div);
  });
  }

  /* âœ… ìƒˆë¡œê³ ì¹¨ í›„ ë¡œê·¸ì¸ ìœ ì§€ */
  supabaseClient.auth.getSession().then(({ data }) => {
    if (data.session) {
      document.getElementById("loginCard").classList.add("hidden");
      document.getElementById("writeCard").classList.remove("hidden");
      document.getElementById("listCard").classList.remove("hidden");
      loadMemories();
    }
  });

(async () => {
  const { data, error } = await supabaseClient.auth.getSession();
  console.log("ì„¸ì…˜ ì²´í¬:", data, error);

  if (data?.session) {
    document.getElementById("loginCard").classList.add("hidden");
    document.getElementById("writeCard").classList.remove("hidden");
    document.getElementById("listCard").classList.remove("hidden");
    loadMemories();
  }
})();


</script>

</body>
</html>

# ì¼ë‹¨ ê¸°ë³¸ ì™„ì„±